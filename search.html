<!DOCTYPE HTML>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<div id="chartContainer" style="height: 370px; width: 70%;"></div>
<label for="cars">Choose a country:</label>

<select id="countries" onchange="getData(document.getElementById('countries').value)">
  <!-- <option value="Romania">Romania</option>
  <option value="France">France</option>
  <option value="USA">USA</option> -->
</select>

<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="scripts/jquery-3.4.1.min.js"></script>
<script>
    
    var dataPoints = [];
    var chart ;
    
$(document).ready(function(){
    $.ajax({
        url: "/allCountries",
        type:"get",
        dataType: "json",
        success: function(data){
        //console.log(data);
            data.forEach((item) => {
                console.log(item);
                    var obj = `<option value="${item}">${item}</option>`;
                    $('#countries').append(obj);
            });
    }
    });
});

function addData() {

while(dataPoints.length > 0) {
    dataPoints.pop();
}

chart = new CanvasJS.Chart("chartContainer", {
    animationEnabled: false,
    theme: "light2",
    title: {
        text: "Searches with keyword Coronavirus by selected country states"
    },
    axisY: {
        title: "Trending",
        titleFontSize: 12
    },
    data: [{
        type: "column",
        dataPoints: dataPoints
    }]
});

for (var i = 0; i < arguments[0].length; i++) {
    dataPoints.push({
        label: arguments[0][i].geoName,
        y: arguments[0][i].value[0],
    });

}
chart.render();

}

function getData(country){

$.ajax({
    url: "/trends/"+country,
    type:"get",
    dataType: "json",
    success: function(data){
        //console.log(data);
        addData(data);
    }
});
}   
    
</script>



</body>
</html>